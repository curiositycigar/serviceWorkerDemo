<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    #field {
      position: relative;
      width: 200px;
      height: 200px;
      background: #fff;
    }

    #field div {
      position: absolute;
      width: 1px;
      height: 1px;
      background: #000;
    }
  </style>
</head>

<body>
  <canvas id="canvas"></canvas>
  <script>
    let p = [128, 255, 2, 3, 254, 5, 6, 7, 8, 253, 251, 248, 243, 13, 14, 242, 241, 239, 238, 19, 20, 21, 22, 237, 235, 25, 26, 234, 28, 29, 231, 31, 32, 33, 34, 35, 36, 230, 227, 39, 224, 41, 42, 43, 44, 45, 223, 221, 48, 219, 50, 51, 217, 53, 54, 214, 56, 213, 58, 59, 212, 210, 208, 206, 205, 202, 201, 199, 197, 69, 195, 194, 72, 193, 191, 188, 76, 77, 186, 179, 175, 81, 174, 83, 84, 173, 169, 87, 88, 166, 163, 161, 92, 159, 158, 95, 96, 156, 98, 154, 100, 153, 146, 145, 143, 142, 106, 107, 108, 139, 110, 111, 112, 113, 114, 115, 137, 136, 118, 119, 120, 121, 122, 123, 124, 132, 1, 127, 192, 126, 130, 131, 4, 133, 134, 135, 117, 116, 138, 109, 244, 15, 105, 104, 16, 103, 102, 17, 23, 24, 150, 151, 152, 101, 99, 155, 233, 229, 94, 226, 222, 49, 218, 90, 216, 55, 60, 167, 168, 211, 61, 64, 203, 85, 82, 80, 176, 177, 65, 79, 66, 198, 182, 183, 70, 185, 71, 74, 75, 190, 46, 0, 125, 9, 252, 184, 196, 249, 11, 67, 246, 245, 178, 140, 144, 18, 148, 97, 62, 209, 30, 86, 157, 38, 165, 215, 164, 52, 93, 225, 220, 47, 160, 187, 40, 240, 91, 57, 228, 129, 37, 247, 232, 207, 27, 149, 236, 172, 171, 12, 162, 204, 68, 141, 89, 180, 200, 73, 250, 189, 78, 10, 63, 181, 170, 147]
    let repeat = 256
    let canvas = document.querySelector('#canvas')
    let ctx = canvas.getContext('2d')
    let width = 800
    let height = 200
    canvas.width = width
    canvas.height = height
    let j = 0
    let step = 0.01
    window.setInterval(function () {
      movCanvas()
    }, 16)
    function movCanvas() {
      let imageData = ctx.getImageData(0, 0, width, height)
      ctx.clearRect(0, 0, width, height)
      ctx.putImageData(imageData, -1, 0)
      ctx.fillRect(width - 1, (perlin(j, j, j) * height), 1, 1)
      j += step
    }
    function perlin(x, y, z) {
      x %= repeat
      y %= repeat
      z %= repeat
      let xi = Math.floor(x) & 255
      let yi = Math.floor(y) & 255
      let zi = Math.floor(z) & 255
      let xf = x - Math.floor(x)
      let yf = x - Math.floor(y)
      let zf = x - Math.floor(z)
      let u = fade(xf)
      let v = fade(yf)
      let w = fade(zf)
      let aaa, aba, aab, abb, baa, bba, bab, bbb;
      aaa = p[p[p[xi] + yi] + zi];
      aba = p[p[p[xi] + inc(yi)] + zi];
      aab = p[p[p[xi] + yi] + inc(zi)];
      abb = p[p[p[xi] + inc(yi)] + inc(zi)];
      baa = p[p[p[inc(xi)] + yi] + zi];
      bba = p[p[p[inc(xi)] + inc(yi)] + zi];
      bab = p[p[p[inc(xi)] + yi] + inc(zi)];
      bbb = p[p[p[inc(xi)] + inc(yi)] + inc(zi)];

      let x1, x2, y1, y2

      x1 = lerp(grad(aaa, xf, yf, zf),           // The gradient function calculates the dot product between a pseudorandom
        grad(baa, xf - 1, yf, zf),             // gradient vector and the vector from the input coordinate to the 8
        u);                                     // surrounding points in its unit cube.
      x2 = lerp(grad(aba, xf, yf - 1, zf),           // This is all then lerped together as a sort of weighted average based on the faded (u,v,w)
        grad(bba, xf - 1, yf - 1, zf),             // values we made earlier.
        u);
      y1 = lerp(x1, x2, v);

      x1 = lerp(grad(aab, xf, yf, zf - 1),
        grad(bab, xf - 1, yf, zf - 1),
        u);
      x2 = lerp(grad(abb, xf, yf - 1, zf - 1),
        grad(bbb, xf - 1, yf - 1, zf - 1),
        u);
      y2 = lerp(x1, x2, v);

      return (lerp(y1, y2, w) + 1) / 2;
    }
    function lerp(a, b, x) {
      return a + x * (b - a);
    }
    function inc(num) {
      return ++num % repeat
    }
    function fade(t) {
      return t * t * t * (t * (6 * t - 15) + 10)
    }
    function grad(hash, x, y, z) {
      switch (hash & 0xF) {
        case 0x0: return x + y;
        case 0x1: return -x + y;
        case 0x2: return x - y;
        case 0x3: return -x - y;
        case 0x4: return x + z;
        case 0x5: return -x + z;
        case 0x6: return x - z;
        case 0x7: return -x - z;
        case 0x8: return y + z;
        case 0x9: return -y + z;
        case 0xA: return y - z;
        case 0xB: return -y - z;
        case 0xC: return y + x;
        case 0xD: return -y + z;
        case 0xE: return y - x;
        case 0xF: return -y - z;
        default: return 0; // never happens
      }
    }
  </script>
</body>

</html>